AWSTemplateFormatVersion: '2010-09-09'
Transform: AWS::Serverless-2016-10-31
Description: SAM Template for Alessandrina serverless application.
Globals:
  Function:
    Timeout: 10
    Runtime: go1.x
    Architectures: [x86_64]
    Environment:
      Variables:
        DB_TABLE: !Ref BooksTable
        DB_CONNECTION: "aws"
        DB_LOG: "false"
    AutoPublishAlias: live
    DeploymentPreference:
      Type: !If [IsProduction, "Canary10Percent5Minutes", "AllAtOnce"]

Conditions:
  IsProduction: !Equals [!Ref "AWS::StackName", "alessandrina-prod"]

Resources:
  BooksAPI:
    Type: AWS::Serverless::HttpApi
    Properties:
      AccessLogSettings:
        DestinationArn: !GetAtt AccessLogGroup.Arn
        Format: '{"requestTime":"$context.requestTime","requestId":"$context.requestId","httpMethod":"$context.httpMethod","path":"$context.path","routeKey":"$context.routeKey","status":"$context.status","responseLatency":"$context.responseLatency","integrationRequestId":"$context.integration.requestId","functionResponseStatus":"$context.integration.status","integrationLatency":"$context.integration.latency","ip":"$context.identity.sourceIp","errorMessage":"$context.error.message","errorResponseType":"$context.error.responseType","integrationErrorMessage":"$context.integrationErrorMessage"}'

  AccessLogGroup:
    Type: AWS::Logs::LogGroup
    Properties:
      LogGroupName: !Sub "/aws/apigateway/${AWS::StackName}/access_log"
      RetentionInDays: 7

  BooksTable:
    Type: AWS::DynamoDB::Table
    Properties:
      KeySchema:
        - AttributeName: id
          KeyType: HASH
      AttributeDefinitions:
        - AttributeName: id
          AttributeType: S
      BillingMode: PAY_PER_REQUEST

  GetBooksFunction:
    Type: AWS::Serverless::Function
    Metadata:
      BuildMethod: makefile
    Properties:
      MemorySize: 128
      CodeUri: .
      Handler: get-books
      Description: Retrieve all books
      Events:
        ApiEvent:
          Type: HttpApi
          Properties:
            ApiId: !Ref BooksAPI
            Path: /books
            Method: GET
      Policies:
        - Version: "2012-10-17"
          Statement:
            - Effect: Allow
              Action: dynamodb:Scan
              Resource: !GetAtt BooksTable.Arn

  GetBooksLogGroup:
    Type: AWS::Logs::LogGroup
    Properties:
      LogGroupName: !Sub "/aws/lambda/${GetBooksFunction}"
      RetentionInDays: 7

  GetBookFunction:
    Type: AWS::Serverless::Function
    Metadata:
      BuildMethod: makefile
    Properties:
      MemorySize: 256
      CodeUri: .
      Handler: get-book
      Description: Retrieve a book
      Events:
        ApiEvent:
          Type: HttpApi
          Properties:
            ApiId: !Ref BooksAPI
            Path: /books/{id}
            Method: GET
      Policies:
        - Version: "2012-10-17"
          Statement:
            - Effect: Allow
              Action: dynamodb:GetItem
              Resource: !GetAtt BooksTable.Arn

  GetBookLogGroup:
    Type: AWS::Logs::LogGroup
    Properties:
      LogGroupName: !Sub "/aws/lambda/${GetBookFunction}"
      RetentionInDays: 7

  CreateBookFunction:
    Type: AWS::Serverless::Function
    Metadata:
      BuildMethod: makefile
    Properties:
      MemorySize: 128
      CodeUri: .
      Handler: create-book
      Description: Create a new book
      Events:
        ApiEvent:
          Type: HttpApi
          Properties:
            ApiId: !Ref BooksAPI
            Path: /books
            Method: POST
      Policies:
        - Version: "2012-10-17"
          Statement:
            - Effect: Allow
              Action: dynamodb:PutItem
              Resource: !GetAtt BooksTable.Arn

  CreateBookLogGroup:
    Type: AWS::Logs::LogGroup
    Properties:
      LogGroupName: !Sub "/aws/lambda/${CreateBookFunction}"
      RetentionInDays: 7

  DeleteBookFunction:
    Type: AWS::Serverless::Function
    Metadata:
      BuildMethod: makefile
    Properties:
      MemorySize: 128
      CodeUri: .
      Handler: delete-book
      Description: Delete a book
      Events:
        ApiEvent:
          Type: HttpApi
          Properties:
            ApiId: !Ref BooksAPI
            Path: /books/{id}
            Method: DELETE
      Policies:
        - Version: "2012-10-17"
          Statement:
            - Effect: Allow
              Action: dynamodb:DeleteItem
              Resource: !GetAtt BooksTable.Arn

  DeleteBookLogGroup:
    Type: AWS::Logs::LogGroup
    Properties:
      LogGroupName: !Sub "/aws/lambda/${DeleteBookFunction}"
      RetentionInDays: 7

  ApplicationDashboard:
    Type: AWS::CloudWatch::Dashboard
    Properties:
      DashboardName: !Sub "${AWS::StackName}-dashboard"
      DashboardBody: !Sub >
        {
          "widgets": [
            {
              "height": 6,
              "width": 8,
              "y": 11,
              "x": 0,
              "type": "metric",
              "properties": {
                "metrics": [
                  [
                    "AWS/Lambda",
                    "Duration",
                    "FunctionName",
                    "${GetBooksFunction}",
                    {
                      "label": "Average",
                      "region": "${AWS::Region}",
                      "yAxis": "right",
                      "stat": "Average"
                    }
                  ],
                  [
                    "...",
                    {
                      "label": "p90",
                      "stat": "p90",
                      "region": "${AWS::Region}",
                      "yAxis": "right"
                    }
                  ],
                  ["...", { "label": "p99", "region": "${AWS::Region}", "yAxis": "right" }]
                ],
                "view": "timeSeries",
                "stacked": true,
                "region": "${AWS::Region}",
                "stat": "p99",
                "period": 60,
                "yAxis": {
                  "right": {
                    "label": "Latency",
                    "min": 0
                  },
                  "left": {
                    "showUnits": false
                  }
                },
                "liveData": false,
                "title": "GetBooksFunction Latencies"
              }
            },
            {
              "height": 7,
              "width": 6,
              "y": 2,
              "x": 6,
              "type": "metric",
              "properties": {
                "metrics": [
                  [
                    "AWS/ApiGateway",
                    "Latency",
                    "ApiId",
                    "${BooksAPI}",
                    {
                      "region": "${AWS::Region}",
                      "label": "Average",
                      "id": "m1",
                      "yAxis": "right",
                      "stat": "Average"
                    }
                  ],
                  [
                    "...",
                    {
                      "region": "${AWS::Region}",
                      "label": "p90",
                      "stat": "p90",
                      "id": "m2",
                      "yAxis": "right"
                    }
                  ],
                  [
                    "...",
                    {
                      "region": "${AWS::Region}",
                      "label": "p99",
                      "id": "m3",
                      "yAxis": "right"
                    }
                  ]
                ],
                "view": "timeSeries",
                "stacked": true,
                "region": "${AWS::Region}",
                "period": 60,
                "stat": "p99",
                "yAxis": {
                  "right": {
                    "label": "Latency",
                    "showUnits": true
                  },
                  "left": {
                    "showUnits": false
                  }
                },
                "title": "Latencies",
                "setPeriodToTimeRange": true
              }
            },
            {
              "height": 7,
              "width": 6,
              "y": 2,
              "x": 0,
              "type": "metric",
              "properties": {
                "metrics": [
                  [
                    "AWS/ApiGateway",
                    "Count",
                    "ApiId",
                    "${BooksAPI}",
                    {
                      "region": "${AWS::Region}",
                      "id": "m1",
                      "visible": false,
                      "color": "#c49c94"
                    }
                  ],
                  [
                    ".",
                    "5xx",
                    ".",
                    ".",
                    { "region": "${AWS::Region}", "id": "m2", "visible": false }
                  ],
                  [
                    ".",
                    "4xx",
                    ".",
                    ".",
                    { "region": "${AWS::Region}", "id": "m3", "visible": false }
                  ],
                  [
                    {
                      "expression": "((m1 - (m2 + m3)) / m1 * 100)",
                      "label": "Availability",
                      "id": "e1",
                      "yAxis": "right",
                      "region": "${AWS::Region}",
                      "color": "#1f77b4",
                      "period": 60
                    }
                  ]
                ],
                "view": "timeSeries",
                "stacked": false,
                "region": "${AWS::Region}",
                "period": 60,
                "stat": "Sum",
                "yAxis": {
                  "right": {
                    "label": "percent",
                    "min": 98,
                    "max": 100,
                    "showUnits": false
                  },
                  "left": {
                    "showUnits": false
                  }
                },
                "title": "Availability",
                "annotations": {
                  "horizontal": [
                    {
                      "label": "Long Impact SLA",
                      "value": 99.9,
                      "yAxis": "right"
                    },
                    {
                      "label": "Short Impact SLA",
                      "value": 99,
                      "yAxis": "right"
                    }
                  ]
                },
                "liveData": false,
                "sparkline": false,
                "singleValueFullPrecision": false,
                "setPeriodToTimeRange": false,
                "trend": true
              }
            },
            {
              "height": 7,
              "width": 6,
              "y": 2,
              "x": 12,
              "type": "metric",
              "properties": {
                "metrics": [
                  [
                    "AWS/ApiGateway",
                    "Count",
                    "ApiId",
                    "${BooksAPI}",
                    { "label": "Requests", "yAxis": "right", "region": "${AWS::Region}" }
                  ]
                ],
                "view": "timeSeries",
                "stacked": false,
                "region": "${AWS::Region}",
                "period": 60,
                "stat": "Sum",
                "yAxis": {
                  "right": {
                    "label": "Count",
                    "showUnits": false
                  },
                  "left": {
                    "showUnits": false
                  }
                },
                "title": "Requests"
              }
            },
            {
              "height": 7,
              "width": 6,
              "y": 2,
              "x": 18,
              "type": "metric",
              "properties": {
                "metrics": [
                  [
                    "AWS/ApiGateway",
                    "4xx",
                    "ApiId",
                    "${BooksAPI}",
                    { "region": "${AWS::Region}", "yAxis": "right" }
                  ],
                  [".", "5xx", ".", ".", { "region": "${AWS::Region}", "yAxis": "right" }]
                ],
                "view": "timeSeries",
                "stacked": true,
                "region": "${AWS::Region}",
                "stat": "Sum",
                "period": 60,
                "yAxis": {
                  "right": {
                    "showUnits": false,
                    "label": "Count"
                  },
                  "left": {
                    "showUnits": false
                  }
                },
                "title": "Errors"
              }
            },
            {
              "height": 6,
              "width": 8,
              "y": 11,
              "x": 8,
              "type": "metric",
              "properties": {
                "metrics": [
                  [
                    {
                      "expression": "(e/i) * 100",
                      "label": "% of invocations that errored",
                      "id": "e1",
                      "region": "${AWS::Region}",
                      "yAxis": "right",
                      "period": 60
                    }
                  ],
                  [
                    "AWS/Lambda",
                    "Invocations",
                    "FunctionName",
                    "${GetBooksFunction}",
                    { "id": "i", "visible": false, "region": "${AWS::Region}" }
                  ],
                  [
                    ".",
                    "Errors",
                    ".",
                    ".",
                    { "id": "e", "visible": false, "region": "${AWS::Region}" }
                  ]
                ],
                "view": "timeSeries",
                "stacked": false,
                "region": "${AWS::Region}",
                "stat": "Sum",
                "period": 60,
                "title": "GetBooksFunction Error %",
                "yAxis": {
                  "left": {
                    "showUnits": false
                  },
                  "right": {
                    "label": "percent",
                    "showUnits": false
                  }
                }
              }
            },
            {
              "height": 6,
              "width": 8,
              "y": 11,
              "x": 16,
              "type": "metric",
              "properties": {
                "metrics": [
                  [
                    {
                      "expression": "(t/i) * 100",
                      "label": "% of throttled requests",
                      "id": "e1",
                      "region": "${AWS::Region}",
                      "yAxis": "right",
                      "period": 60
                    }
                  ],
                  [
                    "AWS/Lambda",
                    "Invocations",
                    "FunctionName",
                    "${GetBooksFunction}",
                    { "id": "i", "region": "${AWS::Region}", "visible": false }
                  ],
                  [
                    ".",
                    "Throttles",
                    ".",
                    ".",
                    { "id": "t", "region": "${AWS::Region}", "visible": false }
                  ]
                ],
                "view": "timeSeries",
                "stacked": false,
                "region": "${AWS::Region}",
                "stat": "Sum",
                "period": 60,
                "title": "GetBooksFunction Throttled %",
                "yAxis": {
                  "right": {
                    "label": "percent",
                    "showUnits": false
                  },
                  "left": {
                    "showUnits": false
                  }
                }
              }
            },
            {
              "height": 6,
              "width": 12,
              "y": 37,
              "x": 0,
              "type": "metric",
              "properties": {
                "metrics": [
                  [
                    "AWS/DynamoDB",
                    "SuccessfulRequestLatency",
                    "TableName",
                    "${BooksTable}",
                    "Operation",
                    "Scan",
                    { "region": "${AWS::Region}", "yAxis": "right" }
                  ],
                  ["...", "GetItem", { "region": "${AWS::Region}", "yAxis": "right" }],
                  ["...", "PutItem", { "region": "${AWS::Region}", "yAxis": "right" }],
                  ["...", "DeleteItem", { "region": "${AWS::Region}", "yAxis": "right" }]
                ],
                "view": "timeSeries",
                "stacked": true,
                "region": "${AWS::Region}",
                "yAxis": {
                  "left": {
                    "showUnits": false
                  },
                  "right": {
                    "label": "Latency",
                    "min": 0,
                    "showUnits": false
                  }
                },
                "title": "Latency",
                "period": 60,
                "stat": "Average"
              }
            },
            {
              "height": 6,
              "width": 12,
              "y": 37,
              "x": 12,
              "type": "metric",
              "properties": {
                "metrics": [
                  [
                    "AWS/DynamoDB",
                    "ConsumedWriteCapacityUnits",
                    "TableName",
                    "${BooksTable}",
                    { "region": "${AWS::Region}", "yAxis": "right" }
                  ],
                  [
                    ".",
                    "ConsumedReadCapacityUnits",
                    ".",
                    ".",
                    { "region": "${AWS::Region}", "yAxis": "right" }
                  ]
                ],
                "view": "timeSeries",
                "stacked": false,
                "region": "${AWS::Region}",
                "yAxis": {
                  "left": {
                    "showUnits": false
                  }
                },
                "title": "Consumed Read/Write Units",
                "period": 60,
                "stat": "Average"
              }
            },
            {
              "height": 2,
              "width": 24,
              "y": 35,
              "x": 0,
              "type": "text",
              "properties": {
                "markdown": "# DynamoDB"
              }
            },
            {
              "height": 2,
              "width": 24,
              "y": 9,
              "x": 0,
              "type": "text",
              "properties": {
                "markdown": "# Lambda"
              }
            },
            {
              "height": 2,
              "width": 24,
              "y": 0,
              "x": 0,
              "type": "text",
              "properties": {
                "markdown": "# HTTP API Gateway"
              }
            },
            {
              "height": 6,
              "width": 8,
              "y": 17,
              "x": 0,
              "type": "metric",
              "properties": {
                "metrics": [
                  [
                    "AWS/Lambda",
                    "Duration",
                    "FunctionName",
                    "${GetBookFunction}",
                    {
                      "label": "Average",
                      "region": "${AWS::Region}",
                      "yAxis": "right",
                      "stat": "Average"
                    }
                  ],
                  [
                    "...",
                    {
                      "label": "p90",
                      "stat": "p90",
                      "region": "${AWS::Region}",
                      "yAxis": "right"
                    }
                  ],
                  ["...", { "label": "p99", "region": "${AWS::Region}", "yAxis": "right" }]
                ],
                "view": "timeSeries",
                "stacked": true,
                "region": "${AWS::Region}",
                "stat": "p99",
                "period": 60,
                "yAxis": {
                  "right": {
                    "label": "Latency",
                    "min": 0
                  },
                  "left": {
                    "showUnits": false
                  }
                },
                "liveData": false,
                "title": "GetBookFunction Latencies"
              }
            },
            {
              "height": 6,
              "width": 8,
              "y": 17,
              "x": 8,
              "type": "metric",
              "properties": {
                "metrics": [
                  [
                    {
                      "expression": "(e/i) * 100",
                      "label": "% of invocations that errored",
                      "id": "e1",
                      "region": "${AWS::Region}",
                      "yAxis": "right",
                      "period": 60
                    }
                  ],
                  [
                    "AWS/Lambda",
                    "Invocations",
                    "FunctionName",
                    "${GetBookFunction}",
                    { "id": "i", "visible": false, "region": "${AWS::Region}" }
                  ],
                  [
                    ".",
                    "Errors",
                    ".",
                    ".",
                    { "id": "e", "visible": false, "region": "${AWS::Region}" }
                  ]
                ],
                "view": "timeSeries",
                "stacked": false,
                "region": "${AWS::Region}",
                "stat": "Sum",
                "period": 60,
                "title": "GetBookFunction Error %",
                "yAxis": {
                  "left": {
                    "showUnits": false
                  },
                  "right": {
                    "showUnits": false,
                    "label": "percent"
                  }
                }
              }
            },
            {
              "height": 6,
              "width": 8,
              "y": 17,
              "x": 16,
              "type": "metric",
              "properties": {
                "metrics": [
                  [
                    {
                      "expression": "(t/i) * 100",
                      "label": "% of throttled requests",
                      "id": "e1",
                      "region": "${AWS::Region}",
                      "yAxis": "right",
                      "period": 60
                    }
                  ],
                  [
                    "AWS/Lambda",
                    "Invocations",
                    "FunctionName",
                    "${GetBookFunction}",
                    { "id": "i", "region": "${AWS::Region}", "visible": false }
                  ],
                  [
                    ".",
                    "Throttles",
                    ".",
                    ".",
                    { "id": "t", "region": "${AWS::Region}", "visible": false }
                  ]
                ],
                "view": "timeSeries",
                "stacked": false,
                "region": "${AWS::Region}",
                "stat": "Sum",
                "period": 60,
                "title": "GetBookFunction Throttled %",
                "yAxis": {
                  "right": {
                    "label": "percent",
                    "showUnits": false
                  }
                }
              }
            },
            {
              "height": 6,
              "width": 8,
              "y": 23,
              "x": 0,
              "type": "metric",
              "properties": {
                "metrics": [
                  [
                    "AWS/Lambda",
                    "Duration",
                    "FunctionName",
                    "${CreateBookFunction}",
                    {
                      "label": "Average",
                      "region": "${AWS::Region}",
                      "yAxis": "right",
                      "stat": "Average"
                    }
                  ],
                  [
                    "...",
                    {
                      "label": "p90",
                      "stat": "p90",
                      "region": "${AWS::Region}",
                      "yAxis": "right"
                    }
                  ],
                  ["...", { "label": "p99", "region": "${AWS::Region}", "yAxis": "right" }]
                ],
                "view": "timeSeries",
                "stacked": true,
                "region": "${AWS::Region}",
                "stat": "p99",
                "period": 60,
                "yAxis": {
                  "right": {
                    "label": "Latency",
                    "min": 0
                  },
                  "left": {
                    "showUnits": false
                  }
                },
                "liveData": false,
                "title": "CreateBookFunction Latencies"
              }
            },
            {
              "height": 6,
              "width": 8,
              "y": 23,
              "x": 8,
              "type": "metric",
              "properties": {
                "metrics": [
                  [
                    {
                      "expression": "(e/i) * 100",
                      "label": "% of invocations that errored",
                      "id": "e1",
                      "region": "${AWS::Region}",
                      "yAxis": "right",
                      "period": 60
                    }
                  ],
                  [
                    "AWS/Lambda",
                    "Invocations",
                    "FunctionName",
                    "${CreateBookFunction}",
                    { "id": "i", "visible": false, "region": "${AWS::Region}" }
                  ],
                  [
                    ".",
                    "Errors",
                    ".",
                    ".",
                    { "id": "e", "visible": false, "region": "${AWS::Region}" }
                  ]
                ],
                "view": "timeSeries",
                "stacked": false,
                "region": "${AWS::Region}",
                "stat": "Sum",
                "period": 60,
                "title": "CreateBookFunction Error %",
                "yAxis": {
                  "left": {
                    "showUnits": false
                  },
                  "right": {
                    "showUnits": false,
                    "label": "percent"
                  }
                }
              }
            },
            {
              "height": 6,
              "width": 8,
              "y": 23,
              "x": 16,
              "type": "metric",
              "properties": {
                "metrics": [
                  [
                    {
                      "expression": "(t/i) * 100",
                      "label": "% of throttled requests",
                      "id": "e1",
                      "region": "${AWS::Region}",
                      "yAxis": "right",
                      "period": 60
                    }
                  ],
                  [
                    "AWS/Lambda",
                    "Invocations",
                    "FunctionName",
                    "${CreateBookFunction}",
                    { "id": "i", "region": "${AWS::Region}", "visible": false }
                  ],
                  [
                    ".",
                    "Throttles",
                    ".",
                    ".",
                    { "id": "t", "region": "${AWS::Region}", "visible": false }
                  ]
                ],
                "view": "timeSeries",
                "stacked": false,
                "region": "${AWS::Region}",
                "stat": "Sum",
                "period": 60,
                "title": "CreateBookFunction Throttled %",
                "yAxis": {
                  "right": {
                    "label": "percent",
                    "showUnits": false
                  }
                }
              }
            },
            {
              "height": 6,
              "width": 8,
              "y": 29,
              "x": 0,
              "type": "metric",
              "properties": {
                "metrics": [
                  [
                    "AWS/Lambda",
                    "Duration",
                    "FunctionName",
                    "${DeleteBookFunction}",
                    {
                      "label": "Average",
                      "region": "${AWS::Region}",
                      "yAxis": "right",
                      "stat": "Average"
                    }
                  ],
                  [
                    "...",
                    {
                      "label": "p90",
                      "stat": "p90",
                      "region": "${AWS::Region}",
                      "yAxis": "right"
                    }
                  ],
                  ["...", { "label": "p99", "region": "${AWS::Region}", "yAxis": "right" }]
                ],
                "view": "timeSeries",
                "stacked": true,
                "region": "${AWS::Region}",
                "stat": "p99",
                "period": 60,
                "yAxis": {
                  "right": {
                    "label": "Latency",
                    "min": 0
                  },
                  "left": {
                    "showUnits": false
                  }
                },
                "liveData": false,
                "title": "DeleteBookFunction Latencies"
              }
            },
            {
              "height": 6,
              "width": 8,
              "y": 29,
              "x": 8,
              "type": "metric",
              "properties": {
                "metrics": [
                  [
                    {
                      "expression": "(e/i) * 100",
                      "label": "% of invocations that errored",
                      "id": "e1",
                      "region": "${AWS::Region}",
                      "yAxis": "right",
                      "period": 60
                    }
                  ],
                  [
                    "AWS/Lambda",
                    "Invocations",
                    "FunctionName",
                    "${DeleteBookFunction}",
                    { "id": "i", "visible": false, "region": "${AWS::Region}" }
                  ],
                  [
                    ".",
                    "Errors",
                    ".",
                    ".",
                    { "id": "e", "visible": false, "region": "${AWS::Region}" }
                  ]
                ],
                "view": "timeSeries",
                "stacked": false,
                "region": "${AWS::Region}",
                "stat": "Sum",
                "period": 60,
                "title": "DeleteBookFunction Error %",
                "yAxis": {
                  "left": {
                    "showUnits": false
                  },
                  "right": {
                    "label": "percent",
                    "showUnits": false
                  }
                }
              }
            },
            {
              "height": 6,
              "width": 8,
              "y": 29,
              "x": 16,
              "type": "metric",
              "properties": {
                "metrics": [
                  [
                    {
                      "expression": "(t/i) * 100",
                      "label": "% of throttled requests",
                      "id": "e1",
                      "region": "${AWS::Region}",
                      "yAxis": "right",
                      "period": 60
                    }
                  ],
                  [
                    "AWS/Lambda",
                    "Invocations",
                    "FunctionName",
                    "${DeleteBookFunction}",
                    { "id": "i", "region": "${AWS::Region}", "visible": false }
                  ],
                  [
                    ".",
                    "Throttles",
                    ".",
                    ".",
                    { "id": "t", "region": "${AWS::Region}", "visible": false }
                  ]
                ],
                "view": "timeSeries",
                "stacked": false,
                "region": "${AWS::Region}",
                "stat": "Sum",
                "period": 60,
                "title": "DeleteBookFunction Throttled %",
                "yAxis": {
                  "right": {
                    "label": "percent",
                    "showUnits": false
                  }
                }
              }
            }
          ]
        }

Outputs:
  WebEndpoint:
    Description: "API Gateway endpoint URL for the Books API"
    Value: !Sub "https://${BooksAPI}.execute-api.${AWS::Region}.amazonaws.com/"

  DashboardURL:
    Description: "Dashboard URL"
    Value: !Sub "https://console.aws.amazon.com/cloudwatch/home?region=${AWS::Region}#dashboards:name=${ApplicationDashboard}"

  GetBooksFunction:
    Description: "GetBooks Lambda Function ARN"
    Value: !GetAtt GetBooksFunction.Arn

  GetBookFunction:
    Description: "GetBook Lambda Function ARN"
    Value: !GetAtt GetBookFunction.Arn

  CreateBookFunction:
    Description: "CreateBook Lambda Function ARN"
    Value: !GetAtt CreateBookFunction.Arn

  DeleteBookFunction:
    Description: "DeleteBook Lambda Function ARN"
    Value: !GetAtt DeleteBookFunction.Arn
